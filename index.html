<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Final Project</title>
  </head>
  <body>
    <canvas id="glCanvas" width="1080" height="720"></canvas>

    <script id="vertex-shader" type="x-shader/x-vertex">
        attribute vec4 a_position;
        attribute vec4 a_normal;
        attribute vec4 a_color;

        uniform mat4 u_model;
        uniform mat4 u_view;
        uniform mat4 u_proj;

        varying vec3 v_normal;
        varying vec3 v_fragPos;
        varying vec4 v_color;

        void main() {
            vec4 worldPosition = u_model * a_position;
            v_fragPos = worldPosition.xyz;
            v_normal = normalize(mat3(u_model) * a_normal.xyz);
            v_color = a_color;

            gl_Position = u_proj * u_view * worldPosition;
        }
    </script>
    <script id="fragment-shader" type="x-shader/x-fragment">
        precision mediump float;


        varying vec3 v_normal;
        varying vec3 v_fragPos;
        varying vec4 v_color;

        uniform vec4 u_lightPos;
        uniform vec3 u_eye;

        void main() {
            float L_e_k = 1.0;
            float L_a_k = 1.0;
            float k_d_k = 1.0;

            vec3 L_e = L_e_k * vec3(1.0, 1.0, 1.0);
            vec3 L_a = L_a_k * vec3(0.2, 0.2, 0.2);

            vec3 k_d = k_d_k * v_color.xyz;
            vec3 k_a = k_d;

            vec3 normal = normalize(v_normal);

            vec3 lightDir = (u_lightPos.w == 0.0) ? normalize(-u_lightPos.xyz) : normalize(u_lightPos.xyz - v_fragPos);

            vec3 viewDir = normalize(u_eye - v_fragPos);

            vec3 reflectDir = reflect(-lightDir, normal);

            vec3 ambient = k_a * L_a;

            float diff = max(dot(normal, lightDir), 0.0);
            vec3 diffuse = k_d * L_e * diff;

            vec3 result = ambient + diffuse;
            gl_FragColor = vec4(result, 1.0);
        }
    </script>
    <script type="text/javascript" src="./common/webgl-utils.js"></script>
    <script type="text/javascript" src="./common/initShaders.js"></script>
    <script type="text/javascript" src="./common/MV.js"></script>
    <script type="text/javascript" src="./common/OBJParser.js"></script>
    <script type="text/javascript" src="script.js"></script>
  </body>
</html>
